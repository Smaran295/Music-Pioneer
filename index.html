<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Pioneer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #121212;
            color: #FFFFFF;
            margin: 0;
            height: 100vh;
            overflow: hidden;
        }
        #sidebar {
            width: 200px;
            background: #1a1a1a;
            height: 100vh;
            position: fixed;
            transition: width 0.3s;
        }
        .logo {
            padding: 20px;
            text-align: center;
            font-size: 24px;
            color: #1DB954;
        }
        .nav-item {
            display: block;
            padding: 15px;
            color: #B3B3B3;
            text-decoration: none;
            border-bottom: 1px solid #333;
        }
        .nav-item:hover, .nav-item.active {
            background: #333;
            color: #1DB954;
        }
        #mainContent {
            margin-left: 200px;
            padding: 20px;
            overflow-y: auto;
            height: 100vh;
        }
        .section { display: none; }
        .section.active { display: block; }
        h2 { color: #1DB954; margin-bottom: 20px; }
        .song-card {
            background: #1a1a1a;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            cursor: pointer;
        }
        .song-card:hover { background: #333; }
        .song-card img { width: 100%; height: 100px; object-fit: cover; border-radius: 5px; }
        .details strong { color: #1DB954; }
        .search-bar input { padding: 10px; background: #1a1a1a; border: 1px solid #333; color: white; width: 70%; }
        .search-bar button { padding: 10px 20px; background: #1DB954; color: black; border: none; cursor: pointer; }
        #playerBar {
            position: fixed;
            bottom: 0;
            left: 200px;
            right: 0;
            height: 60px;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            padding: 0 20px;
        }
        .controls button { font-size: 20px; background: none; border: none; color: #B3B3B3; margin: 0 10px; cursor: pointer; }
        .controls button:hover { color: #1DB954; }
        #progress, #volume { width: 200px; height: 5px; background: #333; }
        #currentSong { position: fixed; bottom: 70px; left: 220px; color: #B3B3B3; }
        .loading { text-align: center; color: #B3B3B3; font-size: 18px; }
        .hamburger { display: none; position: fixed; top: 10px; left: 10px; font-size: 24px; cursor: pointer; z-index: 1000; }
        @media (max-width: 768px) {
            #sidebar { width: 0; }
            #mainContent { margin-left: 0; }
            #playerBar { left: 0; }
            #currentSong { left: 10px; }
            .hamburger { display: block; color: #B3B3B3; }
        }
    </style>
</head>
<body>
    <div class="hamburger" onclick="toggleSidebar()">‚ò∞</div>
    <div id="sidebar">
        <div class="logo">Music Pioneer</div>
        <a href="#" class="nav-item active" onclick="showSection('home')">Home</a>
        <a href="#" class="nav-item" onclick="showSection('search')">Search</a>
        <a href="#" class="nav-item" onclick="showSection('library')">Library</a>
    </div>
    <div id="mainContent">
        <div id="home" class="section active">
            <h2>Home</h2>
            <div class="song-card" onclick="playSample('Deva Deva', 'Arijit Singh')">
                <strong>Deva Deva</strong> - Arijit Singh
            </div>
            <div class="song-card" onclick="playSample('Kesariya', 'Pritam')">
                <strong>Kesariya</strong> - Pritam
            </div>
        </div>
        <div id="search" class="section">
            <div class="search-bar">
                <input type="text" id="query" placeholder="Search songs..." onkeypress="if(event.key==='Enter') searchSongs()">
                <button onclick="searchSongs()">Search</button>
            </div>
            <div id="results"></div>
        </div>
        <div id="library" class="section">
            <h2>Library</h2>
            <div class="song-card" onclick="playSample('Liked Song', 'Various')">
                <strong>Liked Songs</strong> - Various
            </div>
        </div>
    </div>
    <div id="currentSong"></div>
    <div id="playerBar">
        <button onclick="toggleShuffle()">üîÄ</button>
        <button onclick="playPrevious()">‚èÆ</button>
        <button id="playBtn" onclick="togglePlay()">‚ñ∂</button>
        <button onclick="playNext()">‚è≠</button>
        <button onclick="toggleRepeat()">üîÅ</button>
        <input type="range" id="progress" min="0" max="100" value="0" style="flex:1; margin: 0 10px;">
        <button id="muteBtn" onclick="toggleMute()">üîä</button>
        <input type="range" id="volume" min="0" max="1" step="0.1" value="1">
    </div>
    <script>
        let currentAudio = null;
        let queue = [];
        let currentIndex = -1;
        let isShuffling = false;
        let isRepeating = false;
        let progressInterval;
        const API_BASE = 'https://annonymous-sage.vercel.app';
        const TEST_AUDIO = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3';

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.style.width = sidebar.style.width === '0px' ? '200px' : '0px';
        }

        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(section).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');
        }

        async function searchSongs() {
            const query = document.getElementById('query').value.trim();
            const results = document.getElementById('results');
            if (!query) return results.innerHTML = '<p>Enter a search term.</p>';
            results.innerHTML = '<p class="loading">Loading...</p>';
            try {
                const res = await fetch(`${API_BASE}/api/search?query=${encodeURIComponent(query)}`);
                if (!res.ok) throw new Error('API error');
                const data = await res.json();
                console.log('API Response:', data); // Debug
                results.innerHTML = '';
                const songs = data.data?.songs?.results || [];
                if (songs.length === 0) return results.innerHTML = '<p>No results found.</p>';
                songs.slice(0, 10).forEach(song => {
                    const div = document.createElement('div');
                    div.className = 'song-card';
                    div.innerHTML = `
                        <img src="${song.image?.find(img => img.quality === '150x150')?.url || 'https://via.placeholder.com/100?text=Cover'}" alt="${song.title}" onerror="this.src='https://via.placeholder.com/100?text=Cover'">
                        <div class="details">
                            <strong>${song.title || 'Unknown'}</strong><br>
                            <span>${song.primaryArtists || 'Unknown'} ‚Ä¢ ${song.album || 'N/A'}</span>
                        </div>
                    `;
                    div.onclick = () => addToQueue(TEST_AUDIO, song.title, song.primaryArtists, song.image?.[1]?.url || '');
                    results.appendChild(div);
                });
            } catch (err) {
                results.innerHTML = `<p>Error: ${err.message}</p>`;
                console.error('Search failed:', err);
            }
        }

        function addToQueue(url, title, artists, image) {
            queue.push({ url, title, artists, image });
            if (currentIndex === -1) playNext();
        }

        function playNext() {
            if (queue.length === 0) return;
            currentIndex = isShuffling ? Math.floor(Math.random() * queue.length) : (currentIndex + 1) % queue.length;
            playQueue();
        }

        function playPrevious() {
            if (queue.length === 0) return;
            currentIndex = currentIndex > 0 ? currentIndex - 1 : queue.length - 1;
            playQueue();
        }

        function playQueue() {
            if (currentIndex < 0 || currentIndex >= queue.length) return;
            if (currentAudio) currentAudio.pause();
            const item = queue[currentIndex];
            currentAudio = new Audio(item.url);
            document.getElementById('playBtn').textContent = '‚è∏';
            currentAudio.volume = document.getElementById('volume').value;
            currentAudio.play().catch(e => console.error('Play error:', e));
            document.getElementById('currentSong').textContent = `${item.title} - ${item.artists}`;
            updateProgress();
        }

        function playSample(title, artists) {
            addToQueue(TEST_AUDIO, title, artists, '');
        }

        function togglePlay() {
            if (!currentAudio) return;
            if (currentAudio.paused) {
                currentAudio.play();
                document.getElementById('playBtn').textContent = '‚è∏';
            } else {
                currentAudio.pause();
                document.getElementById('playBtn').textContent = '‚ñ∂';
            }
        }

        function toggleMute() {
            if (!currentAudio) return;
            currentAudio.muted = !currentAudio.muted;
            document.getElementById('muteBtn').textContent = currentAudio.muted ? 'üîá' : 'üîä';
        }

        function toggleShuffle() {
            isShuffling = !isShuffling;
            event.target.style.color = isShuffling ? '#1DB954' : '#B3B3B3';
        }

        function toggleRepeat() {
            isRepeating = !isRepeating;
            event.target.style.color = isRepeating ? '#1DB954' : '#B3B3B3';
        }

        function seekAudio(value) {
            if (currentAudio && currentAudio.duration) currentAudio.currentTime = (value / 100) * currentAudio.duration;
        }

        function setVolume(value) {
            if (currentAudio) currentAudio.volume = value;
        }

        function updateProgress() {
            if (progressInterval) clearInterval(progressInterval);
            if (currentAudio) {
                progressInterval = setInterval(() => {
                    const progress = document.getElementById('progress');
                    if (!currentAudio.paused && currentAudio.duration) {
                        progress.value = (currentAudio.currentTime / currentAudio.duration) * 100;
                    }
                    if (currentAudio.ended) playNext();
                }, 1000);
                currentAudio.addEventListener('timeupdate', () => {
                    const progress = document.getElementById('progress');
                    progress.value = (currentAudio.currentTime / currentAudio.duration) * 100 || 0;
                });
            }
        }

        // Init
        document.getElementById('progress').oninput = (e) => seekAudio(e.target.value);
        document.getElementById('volume').oninput = (e) => setVolume(e.target.value);
        showSection('home');
        document.getElementById('query').oninput = () => setTimeout(searchSongs, 500); // Debounce
        alert('Music Pioneer loaded! Search for "kesariya" to test.'); // Online debug
        console.log('App initialized - API ready.');
    </script>
</body>
</html>
