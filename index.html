<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Player</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #121212;
            color: #ffffff;
            margin: 20px;
        }
        .song-list {
            display: grid;
            gap: 10px;
            max-width: 600px;
        }
        .song-card {
            background: #282828;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        .song-card img {
            width: 50px;
            height: 50px;
            margin-right: 10px;
        }
        .song-card .details {
            flex-grow: 1;
        }
        .song-card .details strong {
            display: block;
        }
        .player {
            margin-top: 20px;
            padding: 10px;
            background: #181818;
            border-radius: 4px;
            display: none;
        }
        .player.active {
            display: block;
        }
    </style>
</head>
<body>
    <div id="songList" class="song-list"></div>
    <div id="player" class="player">
        <img id="playerImg" src="" alt="">
        <div class="player-info">
            <strong id="playerTitle"></strong>
            <span id="playerArtist"></span>
        </div>
        <button onclick="togglePlay()" id="playBtn">Play</button>
    </div>
    <script>
        let currentAudio = null;
        const API_BASE = 'https://annonymous-sage.vercel.app';

        async function fetchSongs() {
            const songList = document.getElementById('songList');
            songList.innerHTML = 'Loading...';
            try {
                const response = await fetch(`${API_BASE}/api/search/songs?query=top%20charts`);
                if (!response.ok) throw new Error('Failed to fetch');
                const data = await response.json();
                renderSongs(data.data.results || data.data);
            } catch (error) {
                songList.innerHTML = 'Error loading songs.';
            }
        }

        function renderSongs(songs) {
            const songList = document.getElementById('songList');
            songList.innerHTML = '';
            songs.forEach(song => {
                const title = song.name || song.title || 'Unknown';
                const artist = (song.artists?.primary?.map(a => a.name).join(', ')) || 'Unknown';
                const imageUrl = (song.image && song.image[2]?.url) || 'https://via.placeholder.com/50';
                const url = (song.downloadUrl && song.downloadUrl.find(u => u.quality === '320kbps')?.url) || song.media_url || '';
                const id = song.id;

                const div = document.createElement('div');
                div.className = 'song-card';
                div.innerHTML = `
                    <img src="${imageUrl}" alt="${title}">
                    <div class="details">
                        <strong>${title}</strong>
                        <span>${artist}</span>
                    </div>
                `;
                div.addEventListener('click', () => playSong(url, title, artist, imageUrl));
                songList.appendChild(div);
            });
        }

        function playSong(url, title, artist, imageUrl) {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            currentAudio = new Audio(url);
            currentAudio.crossOrigin = "anonymous";
            document.getElementById('player').classList.add('active');
            document.getElementById('playerImg').src = imageUrl;
            document.getElementById('playerTitle').textContent = title;
            document.getElementById('playerArtist').textContent = artist;
            document.getElementById('playBtn').textContent = 'Pause';
            currentAudio.play().catch(err => {
                console.error('Playback error:', err);
                document.getElementById('playerTitle').textContent = 'Error playing song';
            });
        }

        function togglePlay() {
            if (currentAudio) {
                if (currentAudio.paused) {
                    currentAudio.play().catch(err => console.error('Play error:', err));
                    document.getElementById('playBtn').textContent = 'Pause';
                } else {
                    currentAudio.pause();
                    document.getElementById('playBtn').textContent = 'Play';
                }
            }
        }

        // Initial load
        fetchSongs();
    </script>
</body>
</html>
